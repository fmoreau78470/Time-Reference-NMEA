# ==========================================================
# CONFIGURATION NTP - MODE TERRAIN (PILOTE 20 NMEA)
# ==========================================================

# Emplacement du fichier de dérive (drift)
driftfile "C:\Program Files (x86)\NTP\etc\ntp.drift"

# --- 1. CONFIGURATION DES LOGS & STATISTIQUES ---
# Nécessaire pour NTP Time Server Monitor
statsdir "C:\Program Files (x86)\NTP\etc\"
statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

# --- 2. SERVEURS WEB (Sources secondaires) ---
# On les garde pour la comparaison, mais le GPS sera prioritaire
server 0.fr.pool.ntp.org iburst noselect
server 1.fr.pool.ntp.org iburst noselect
server 2.fr.pool.ntp.org iburst noselect
server 3.fr.pool.ntp.org iburst noselect

# --- 3. SOURCE GNSS (Pilote 20 NMEA) ---
# Adresse : 127.127.20.X (X = numéro du port COM, ici COM8)
# Mode 17 : 9600 baud + trame $GPRMC
server 127.127.20.8 mode 17 minpoll 4 maxpoll 4 prefer

# --- 4. PARAMÈTRES FUDGE ---
# stratum 1 : Indique que c'est une source de référence directe
# refid GPS  : Nom affiché dans ntpq
# time1      : Offset pour le signal PPS (si présent sur DCD)
# time2      : Offset pour la trame série NMEA (Latence USB/Série)

fudge 127.127.20.8 stratum 1 refid GPS
fudge 127.127.20.8 time1 0.000
fudge 127.127.20.8 time2 0.1349  # Valeur par défaut à affiner selon l'écart observé
